<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Dating Sim â€” Casual Sorry</title>

<style>
body {
    margin: 0;
    height: 100vh;
    width: 100vw;
    background: url("Artboard 1 copy.png") center / cover no-repeat;
    position: relative;
    overflow: hidden;
    font-family: Arial, sans-serif;
}

/* FULLSCREEN CLICK CATCHER (ADVANCES DIALOGUE) */
.click-catcher{
    position:absolute;
    inset:0;
    z-index:1;
    cursor:pointer;
}

/* SCENE */
.scene {
    position: absolute;
    inset: 0;
    transform-origin: center;
    z-index: 2;
    pointer-events: none; /* UI handles clicks, catcher handles dialogue */
}

/* EXPLOSION */
.scene.explode { animation: explode .6s ease-out forwards; }
@keyframes explode {
    0%   { transform: scale(1); filter: brightness(1); }
    30%  { transform: scale(1.08) translate(-12px, 6px); }
    60%  { transform: scale(1.15) translate(14px, -10px); filter: brightness(2); }
    100% { transform: scale(1.25); filter: brightness(3); }
}

/* FLASH */
.flash {
    position: absolute; inset:0;
    background:white; opacity:0;
    z-index: 90;
    pointer-events:none;
}
.flash.active { animation: flash .3s ease; }
@keyframes flash { 0%{opacity:0} 50%{opacity:1} 100%{opacity:0} }

/* FADE */
.fade {
    position:absolute; inset:0;
    background:black; opacity:0;
    transition: opacity 1s ease;
    z-index: 100;
    pointer-events:none;
}
.fade.active { opacity:1; }

/* CHARACTER */
.character {
    position:absolute;
    bottom:0; left:0;
    width:32%;
    z-index: 3;
    pointer-events:none;
}

/* DIALOGUE BOX */
.dialogue-box {
    position:absolute;
    bottom:3%;
    left:50%;
    transform:translateX(-50%);
    width:70%;
    max-width:900px;
    z-index: 4;
    pointer-events:none;
}
.dialogue-box img { width:100%; display:block; }

/* TEXT */
.dialogue-text {
    position:absolute;
    bottom:13%;
    left:50%;
    transform:translateX(-50%);
    width:60%;
    max-width:750px;
    font-size:1.6rem;
    font-weight:bold;
    color:black;
    z-index: 5;
    pointer-events:none;
    animation: pop .35s ease;
}
@keyframes pop {
    from { opacity:0; transform:translateX(-50%) scale(.96); }
    to   { opacity:1; transform:translateX(-50%) scale(1); }
}

/* STOP OPTION (BUTTOND.PNG) */
.option {
    position:absolute;
    top:50%;
    right:5%;
    transform:translateY(-50%);
    display:none;
    z-index: 200;          /* ABOVE EVERYTHING */
    cursor:pointer;
    pointer-events:auto;   /* MUST be clickable */
}
.option img { width:260px; display:block; }
.option-label{
    position:absolute;
    inset:0;
    display:flex;
    align-items:center;
    justify-content:center;
    color:white;
    font-size:1.4rem;
    font-weight:bold;
    text-shadow:1px 1px 4px black;
    pointer-events:none; /* clicking label still clicks the option container */
}
</style>
</head>

<body>

<audio id="explosionSound" src="Explosion.mp3" preload="auto"></audio>

<!-- CLICK LAYER -->
<div class="click-catcher" id="clickCatcher"></div>

<!-- VISUALS -->
<div class="scene" id="scene">
    <img src="ModH.png" class="character" alt="Character">

    <div class="dialogue-box">
        <img src="DBox.png" alt="Dialogue Box">
    </div>

    <div class="dialogue-text" id="dialogueText"></div>
</div>

<!-- STOP OPTION -->
<div class="option" id="stopOption" role="button" aria-label="stop">
    <img src="ButtonD.png" alt="Stop option">
    <div class="option-label">stop</div>
</div>

<div class="flash" id="flash"></div>
<div class="fade" id="fade"></div>

<script>
const dialogue = [
    "You: I'm really sorry about that.",
    "???: Its ok, Im sorry.",
    "You: why?",
    "???: I should have noticed you and looked beforehand.",
    "You: No im sorry that I was being careless.",
    "???: But dont blame yourself, im sorry for grabbing your book, you clearly have the right of way.",
    "You: I see where you're coming from but its my fault, really, im the one whos sorry.",
    "???: No no no, I assure you im the one who should apologize.",
    "You: Please let me make things right, I ask you accept my apology...",
    "???: But it is I who should be so-"
];

let index = 0;
const midpoint = Math.floor(dialogue.length / 2);

const text = document.getElementById("dialogueText");
const scene = document.getElementById("scene");
const flash = document.getElementById("flash");
const fade = document.getElementById("fade");
const stopOption = document.getElementById("stopOption");
const explosionSound = document.getElementById("explosionSound");
const clickCatcher = document.getElementById("clickCatcher");

/* INIT */
text.textContent = dialogue[index];

/* STOP CLICK */
stopOption.addEventListener("click", (e) => {
    e.preventDefault();
    e.stopPropagation();
    window.location.href = "CasualBreak.html";
});

/* ADVANCE CLICK (ONLY ON CATCHER) */
clickCatcher.addEventListener("click", (e) => {
    // if stop button is visible and click somehow lands on it, ignore here
    if (e.target.closest("#stopOption")) return;

    index++;

    if (index < dialogue.length) {
        updateText();

        if (index === midpoint) stopOption.style.display = "block";
        if (index > midpoint) stopOption.style.display = "none";
    } else {
        explodeScene();
    }
});

function updateText() {
    text.textContent = dialogue[index];
    text.style.animation = "none";
    text.offsetHeight;
    text.style.animation = "pop .35s ease";
}

function explodeScene() {
    stopOption.style.display = "none";

    scene.classList.add("explode");
    flash.classList.add("active");

    explosionSound.currentTime = 0;
    explosionSound.play().catch(()=>{});

    setTimeout(() => fade.classList.add("active"), 500);
    setTimeout(() => window.location.href = "CasualLBfail.html", 1500);
}
</script>

</body>
</html>
